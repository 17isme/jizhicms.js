<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title || '极致CMS管理后台' %></title>
    <meta name="description" content="极致CMS Node.js版本管理后台">
    <meta name="keywords" content="CMS,管理后台,极致CMS">
    
    <!-- CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="/admin/css/admin.css" rel="stylesheet">
    
    <!-- 自定义样式 -->
    <% if (typeof customCss !== 'undefined') { %>
        <% customCss.forEach(function(css) { %>
            <link href="<%= css %>" rel="stylesheet">
        <% }); %>
    <% } %>
</head>
<body class="admin-body">
    <div id="admin-wrapper">
        <!-- 侧边栏 -->
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <div class="brand">
                    <i class="fas fa-crown"></i>
                    <span>极致CMS</span>
                </div>
                <button type="button" id="sidebarCollapse" class="btn btn-link">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <div class="sidebar-user">
                <div class="user-avatar">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="user-info">
                    <div class="user-name"><%= user.name || user.username %></div>
                    <div class="user-role"><%= user.groupname || '管理员' %></div>
                </div>
            </div>

            <ul class="sidebar-menu">
                <li class="menu-item">
                    <a href="/admin" class="menu-link">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>控制台</span>
                    </a>
                </li>
                
                <li class="menu-item has-submenu">
                    <a href="#" class="menu-link">
                        <i class="fas fa-edit"></i>
                        <span>内容管理</span>
                        <i class="fas fa-chevron-down submenu-toggle"></i>
                    </a>
                    <ul class="submenu">
                        <li><a href="/admin/article/list"><i class="fas fa-file-alt"></i>文章管理</a></li>
                        <li><a href="/admin/classtype/list"><i class="fas fa-folder"></i>栏目管理</a></li>
                        <li><a href="/admin/fields/list"><i class="fas fa-list"></i>字段管理</a></li>
                    </ul>
                </li>

                <li class="menu-item has-submenu">
                    <a href="#" class="menu-link">
                        <i class="fas fa-users"></i>
                        <span>用户管理</span>
                        <i class="fas fa-chevron-down submenu-toggle"></i>
                    </a>
                    <ul class="submenu">
                        <li><a href="/admin/admin/list"><i class="fas fa-user-shield"></i>管理员</a></li>
                        <li><a href="/admin/admin/group"><i class="fas fa-users-cog"></i>角色组</a></li>
                        <li><a href="/admin/member/list"><i class="fas fa-user"></i>会员管理</a></li>
                    </ul>
                </li>

                <li class="menu-item has-submenu">
                    <a href="#" class="menu-link">
                        <i class="fas fa-cogs"></i>
                        <span>系统管理</span>
                        <i class="fas fa-chevron-down submenu-toggle"></i>
                    </a>
                    <ul class="submenu">
                        <li><a href="/admin/sys/config"><i class="fas fa-sliders-h"></i>系统配置</a></li>
                        <li><a href="/admin/sys/cache"><i class="fas fa-sync"></i>缓存管理</a></li>
                        <li><a href="/admin/sys/log"><i class="fas fa-list-alt"></i>系统日志</a></li>
                    </ul>
                </li>

                <li class="menu-item">
                    <a href="/admin/upload" class="menu-link">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <span>文件上传</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- 主内容区 -->
        <div id="content" class="content">
            <!-- 顶部导航栏 -->
            <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
                <div class="container-fluid">
                    <button type="button" id="sidebarCollapseTop" class="btn btn-link d-lg-none">
                        <i class="fas fa-bars"></i>
                    </button>
                    
                    <div class="navbar-nav ms-auto">
                        <!-- 快捷操作 -->
                        <div class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-plus"></i> 快速创建
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="/admin/article/add"><i class="fas fa-file-alt"></i> 新建文章</a></li>
                                <li><a class="dropdown-item" href="/admin/classtype/add"><i class="fas fa-folder"></i> 新建栏目</a></li>
                                <li><a class="dropdown-item" href="/admin/admin/add"><i class="fas fa-user-plus"></i> 新建管理员</a></li>
                            </ul>
                        </div>

                        <!-- 系统信息 -->
                        <div class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-bell"></i>
                                <span class="badge bg-danger">3</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#"><i class="fas fa-info-circle"></i> 系统通知</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-exclamation-triangle"></i> 安全提醒</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-cog"></i> 通知设置</a></li>
                            </ul>
                        </div>

                        <!-- 用户菜单 -->
                        <div class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user-circle"></i> <%= user.name || user.username %>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="/admin/profile"><i class="fas fa-user"></i> 个人资料</a></li>
                                <li><a class="dropdown-item" href="/admin/password"><i class="fas fa-key"></i> 修改密码</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="/" target="_blank"><i class="fas fa-eye"></i> 查看前台</a></li>
                                <li><a class="dropdown-item" href="/admin/logout"><i class="fas fa-sign-out-alt"></i> 退出登录</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- 面包屑导航 -->
            <% if (typeof breadcrumb !== 'undefined' && breadcrumb.length > 0) { %>
            <nav aria-label="breadcrumb" class="breadcrumb-nav">
                <div class="container-fluid">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/admin"><i class="fas fa-home"></i> 首页</a></li>
                        <% breadcrumb.forEach(function(item, index) { %>
                            <% if (index === breadcrumb.length - 1) { %>
                                <li class="breadcrumb-item active" aria-current="page"><%= item.name %></li>
                            <% } else { %>
                                <li class="breadcrumb-item"><a href="<%= item.url %>"><%= item.name %></a></li>
                            <% } %>
                        <% }); %>
                    </ol>
                </div>
            </nav>
            <% } %>

            <!-- 页面内容 -->
            <main class="main-content">
                <div class="container-fluid">
                    <!-- 页面标题 -->
                    <% if (typeof pageTitle !== 'undefined') { %>
                    <div class="page-header">
                        <h1 class="page-title">
                            <% if (typeof pageIcon !== 'undefined') { %>
                                <i class="<%= pageIcon %>"></i>
                            <% } %>
                            <%= pageTitle %>
                        </h1>
                        <% if (typeof pageDescription !== 'undefined') { %>
                            <p class="page-description"><%= pageDescription %></p>
                        <% } %>
                    </div>
                    <% } %>

                    <!-- 主要内容区域 -->
                    <%- body %>
                </div>
            </main>
        </div>
    </div>

    <!-- 返回顶部按钮 -->
    <button type="button" class="btn btn-primary back-to-top" id="backToTop">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Loading 遮罩 -->
    <div id="loading" class="loading-mask" style="display: none;">
        <div class="loading-spinner">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <div class="loading-text">处理中...</div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="/admin/js/admin.js"></script>
    
    <!-- 自定义JS -->
    <% if (typeof customJs !== 'undefined') { %>
        <% customJs.forEach(function(js) { %>
            <script src="<%= js %>"></script>
        <% }); %>
    <% } %>

    <!-- 页面级JS -->
    <% if (typeof pageJs !== 'undefined') { %>
        <script>
            <%- pageJs %>
        </script>
    <% } %>
</body>
</html>