<%
// 设置页面变量
const pageTitle = '发布文章';
const pageIcon = 'fas fa-pen';
const pageDescription = '发布新的文章内容';
const breadcrumb = [
    { name: '内容管理', url: '#' },
    { name: '文章管理', url: '/admin/article/list' },
    { name: '发布文章', url: '#' }
];
%>

<form action="/admin/article/save" method="POST" data-ajax="true" data-validate="true">
    <div class="row">
        <!-- 左侧主要信息 -->
        <div class="col-lg-9">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">基本内容</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">文章标题 <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" name="title" required placeholder="请输入文章标题">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">所属栏目 <span class="text-danger">*</span></label>
                        <select class="form-select" name="tid" required>
                            <option value="">请选择栏目</option>
                            <% if (typeof classtypes !== 'undefined') { %>
                                <% classtypes.forEach(function(item) { %>
                                    <option value="<%= item.id %>">
                                        <%
                                        let level = 0;
                                        if (item.pid > 0) level = 1;
                                        %>
                                        <%= '　'.repeat(level) + (level > 0 ? '├─ ' : '') + item.title %>
                                    </option>
                                <% }); %>
                            <% } %>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">文章内容</label>
                        <textarea class="form-control" name="body" rows="15" id="editor"></textarea>
                    </div>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">SEO设置</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">关键词</label>
                        <input type="text" class="form-control" name="keywords" placeholder="多个关键词用逗号分隔">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">描述</label>
                        <textarea class="form-control" name="description" rows="3" placeholder="文章描述信息，留空自动提取"></textarea>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">TAG标签</label>
                        <input type="text" class="form-control" name="tags" placeholder="多个标签用逗号分隔">
                    </div>
                </div>
            </div>
        </div>

        <!-- 右侧属性设置 -->
        <div class="col-lg-3">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">发布设置</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">缩略图</label>
                        <div class="text-center mb-2">
                            <img src="/admin/images/nopic.png" id="litpic-preview" alt="预览" class="img-fluid rounded" style="max-height: 150px; display: none;">
                        </div>
                        <div class="input-group">
                            <input type="text" class="form-control form-control-sm" name="litpic" id="litpic" placeholder="图片地址">
                            <button class="btn btn-outline-secondary btn-sm" type="button" onclick="$('#file-litpic').click()">上传</button>
                        </div>
                        <input type="file" id="file-litpic" class="d-none" onchange="uploadFile(this.files[0], (res) => {
                            $('#litpic').val(res.url);
                            $('#litpic-preview').attr('src', res.url).show();
                        })">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">自定义URL</label>
                        <input type="text" class="form-control" name="ownurl" placeholder="留空则自动生成">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">外部链接</label>
                        <input type="text" class="form-control" name="target" placeholder="跳转链接，非跳转留空">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">排序</label>
                        <input type="number" class="form-control" name="orders" value="0">
                        <div class="form-text">数字越小越靠前</div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">属性</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="jzattr[]" value="1" id="attr1">
                            <label class="form-check-label" for="attr1">推荐</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="jzattr[]" value="2" id="attr2">
                            <label class="form-check-label" for="attr2">置顶</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="jzattr[]" value="3" id="attr3">
                            <label class="form-check-label" for="attr3">头条</label>
                        </div>
                        <input type="hidden" name="jzattr" id="jzattr-val">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">状态</label>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="isshow" name="isshow" value="1" checked>
                            <label class="form-check-label" for="isshow">发布</label>
                        </div>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> 立即发布
                        </button>
                        <button type="button" class="btn btn-outline-secondary">
                            <i class="fas fa-clock"></i> 定时发布
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

<script>
$(document).ready(function() {
    // 处理多选框的值
    $('form').on('submit', function() {
        const attrs = [];
        $('input[name="jzattr[]"]:checked').each(function() {
            attrs.push($(this).val());
        });
        $('#jzattr-val').val(attrs.join(','));
    });
});
</script>